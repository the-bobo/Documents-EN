# 无状态服务 vs 有状态服务

在Alauda云平台中，可以创建两种服务：无状态服务和有状态服务。

## 无状态服务（Stateless Service）

是指该服务运行的实例不会在本地存储需要持久化的数据，并且多个实例对于同一个请求响应的结果是完全一致的。这类服务在alauda云平台创建后，会自动创建一个负载均衡器（Load Balancer，以下简称LB），当访问该服务的请求到达服务一端后，LB会随机找到一个实例来完成该请求的响应。这类服务的实例可能会因为一些原因停止或者重新创建（如在开启自动服务容量调节的情况下），这时，这些停止的实例里的所有信息（除日志和监控数据外）都将丢失。因此如果您的容器实例里需要保留重要的信息，并希望随时可以备份以便于以后可以恢复的话，那么建议您创建有状态服务。

## 有状态服务（Stateful Service）
是指该服务的实例可以将一部分数据随时进行备份，并且在创建一个新的有状态服务时，可以通过备份恢复这些数据，以达到数据持久化的目的。有状态服务只能有一个实例，因此不支持“自动服务容量调节”。一般来说，数据库服务或者需要在本地文件系统存储配置文件或其它永久数据的应用程序可以创建使用有状态服务。要想创建有状态服务，必须满足几个前提：(1)待创建的服务镜像（image）的Dockerfile中必须定义了存储卷（Volumn），因为只有存储卷所在目录里的数据可以被备份；(2)创建服务时，必须指定给该存储卷分配的磁盘空间大小；(3)如果创建服务的同时需要从之前的一个备份里恢复数据，那么还要指明该存储卷用哪个备份恢复。

无状态服务和有状态服务主要有以下几点区别：

* 实例数量：无状态服务可以有一个或多个实例，因此支持两种服务容量调节模式；有状态服务只能有一个实例，不允许创建多个实例，因此也不支持服务容量调节模式。
* 存储卷：无状态服务可以有存储卷，也可以没有，即使有也无法备份存储卷里面的数据；有状态服务必须要有存储卷，并且在创建服务时，必须指定给该存储卷分配的磁盘空间大小。
* 数据存储：无状态服务运行过程中的所有数据（除日志和监控数据）都存在容器实例里的文件系统中，如果实例停止或者删除，则这些数据都将丢失，无法找回；而对于有状态服务，凡是已经挂载了存储卷的目录下的文件内容都可以随时进行备份，备份的数据可以下载，也可以用于恢复新的服务。但对于没有挂载卷的目录下的数据，仍然是无法备份和保存的，如果实例停止或者删除，这些非挂载卷里的文件内容同样会丢失。
